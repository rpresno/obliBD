/*3) Obtener el nombre del piloto y los datos de los pasajeros que hayan viajado alguna vez a
Brasil en el segundo trimestre del año pasado. Considerar únicamente los pasajeros que
tengan entre 20 y 30 años y que hayan viajado solamente en aviones de modelo Boeing*/

SELECT DISTINCT pi.nombre as Piloto, p.*
FROM PASAJERO p
INNER JOIN VIAJE v
    ON p.nrodoc = v.nrodocpasajero
    AND p.pais = v.paispasajero
    AND p.tipodoc = v.tipodocpasajero
INNER JOIN PILOTO pi
    ON pi.numeropiloto = v.numeropiloto
WHERE EXISTS (
        SELECT *
        FROM PASAJERO p2
        INNER JOIN VIAJE v2
            ON p2.nrodoc = v2.nrodocpasajero
            AND p2.pais = v2.paispasajero
            AND p2.tipodoc = v2.tipodocpasajero
        WHERE p.nrodoc = p2.nrodoc
            AND p.pais = p2.pais
            AND p.tipodoc = p2.tipodoc
            AND UPPER(v2.paisdestino) = 'BRASIL'
            AND EXTRACT (YEAR from v2.fechaviaje) = 2023
            AND EXTRACT (MONTH from v2.fechaviaje) BETWEEN 4 AND 6
        )
    AND EXTRACT (YEAR from (p.fechanacimiento)) BETWEEN 1994 AND 2004
    AND NOT EXISTS (
        SELECT *
        FROM PASAJERO p3
        INNER JOIN VIAJE v3
            ON p3.nrodoc = v3.nrodocpasajero
            AND p3.pais = v3.paispasajero
            AND p3.tipodoc = v3.tipodocpasajero
        INNER JOIN AVION a3
            ON v3.idavion = a3.idavion
        WHERE p.nrodoc = p3.nrodoc
            AND p.pais = p3.pais
            AND p.tipodoc = p3.tipodoc
            AND UPPER(a3.modelo) <> 'BOEING' 
        )

